DROP SCHEMA IF EXISTS $schema CASCADE;
CREATE SCHEMA $schema;

CREATE TABLE $schema.vacancies (
	id BIGINT PRIMARY KEY,
	employer VARCHAR,
	position VARCHAR,
	city VARCHAR,
	description VARCHAR,
	load_dttm TIMESTAMP DEFAULT CURRENT_TIMESTAMP
	);

CREATE TABLE $schema.key_skills (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	skill VARCHAR UNIQUE,
	load_dttm TIMESTAMP DEFAULT CURRENT_TIMESTAMP
	);

CREATE TABLE $schema.vacancies_key_skills (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	vacancy_id BIGINT
		REFERENCES $schema.vacancies(id)
			ON DELETE CASCADE,
	key_skill_id BIGINT
		REFERENCES $schema.key_skills(id)
			ON DELETE RESTRICT,
	load_dttm TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	UNIQUE(vacancy_id, key_skill_id)
	);